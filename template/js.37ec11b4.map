{"version":3,"sources":["template2/js/index.js"],"names":["$maskRule","$","$mask","$winning","$card","$close","win","show","addClass","setTimeout","click","hide","removeClass","queryString","name","replace","regexS","results","RegExp","exec","window","location","search","decodeURIComponent","$canvas","clientWidth","document","documentElement","canvasWidth","Math","floor","canvasHeight","ctx","getContext","$canvasMask","$btn","$change","data","count","empty","bool","init","html","attr","beginPath","fillStyle","lineCap","lineJoin","lineWidth","fillRect","closePath","globalCompositeOperation","css","outerHeight","eventMove","e","event","preventDefault","touches","x","pageX","offset","left","y","pageY","top","lineTo","stroke","clear","getImageData","half","i","length","clearRect","alert","on","mousedown","moveTo","mouseup","Swiper","direction","loop","slidesPerView"],"mappings":"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","file":"js.37ec11b4.map","sourceRoot":"..","sourcesContent":["var $maskRule = $(\"#mask-rule\"),//规则遮罩层\n  $mask = $(\"#mask\"),//红包遮罩层\n  $winning = $(\".winning\"),//红包\n  $card = $(\"#card\"),\n  $close = $(\"#close\");\n//link = false;//判断是否在链接跳转中\n\n//规则\n$(\".rule\").click(function () {\n  $maskRule.show();\n});\n$(\"#close-rule\").click(function () {\n  $maskRule.hide();\n});\n\n/*中奖信息提示*/\nfunction win() {\n  //遮罩层显示\n  $mask.show();\n  $winning.addClass(\"reback\");\n  setTimeout(function () {\n    $card.addClass(\"pull\");\n  }, 500);\n\n  //关闭弹出层\n  $(\"#close,.win,.btn\").click(function () {\n    //$close.click(function () {\n    $mask.hide();\n    $winning.removeClass(\"reback\");\n    $card.removeClass(\"pull\");\n  });\n}\n\n//此处可以在commonjs中合并\nfunction queryString(name) {\n  name = name.replace(/[\\[]/, \"\\\\\\[\").replace(/[\\]]/, \"\\\\\\]\");\n  var regexS = \"[\\\\?&]\" + name + \"=([^&#]*)\";\n  var regex = new RegExp(regexS);\n  var results = regex.exec(window.location.search);\n  if (results === null) {\n    return \"\";\n  }\n  else {\n    return decodeURIComponent(results[1].replace(/\\+/g, \" \"));\n  }\n}\n$(function () {\n    var $canvas = $(\"#canvas\"),//canvas\n        clientWidth = document.documentElement.clientWidth,\n        canvasWidth = Math.floor(clientWidth * 562 / 750),//canvas宽 = 屏幕宽 * 设计稿里canvas宽 / 750\n        canvasHeight = Math.floor(clientWidth * 308 / 750),//canvas高 = 屏幕宽 * 设计稿里canvas高 / 750\n        ctx = $canvas[0].getContext(\"2d\"),//获取canvas的2d绘制对象\n        $canvasMask = $(\"#canvas-mask\"),//canvas遮罩层\n        $btn = $(\"#btn\"),//刮奖按钮\n        $change = $(\"#change\"),//剩余次数\n        data = {count: 5},//次数\n        empty = false,\n        bool = false;//判断是否按下去，true为按下，false未按下\n\n    //canvas初始化\n    init();\n\n    function init() {\n        $canvasMask.show();\n        $change.html(data.count);//显示剩余次数\n        //设置canvas宽高\n        $canvas.attr('width', canvasWidth);\n        $canvas.attr('height', canvasHeight);\n\n        //canvas绘图\n        ctx.beginPath();\n        ctx.fillStyle = '#999';//刮刮乐图层的填充色\n        ctx.lineCap = \"round\";//绘制的线结束时为圆形\n        ctx.lineJoin = \"round\";//当两条线交汇时创建圆形边角\n        ctx.lineWidth = 20;//单次刮开面积\n        ctx.fillRect(0, 0, canvasWidth, canvasHeight);\n        ctx.closePath();\n\n        ctx.globalCompositeOperation = 'destination-out';//新图像和原图像重合部分变透明\n        //下面3行代码是为了修复部分手机浏览器不支持destination-out\n        $canvas.css(\"display\", \"none\");\n        $canvas.outerHeight();\n        $canvas.css(\"display\", \"inherit\");\n    }\n\n    //点击开始刮奖按钮\n    $btn.click(function () {\n        if (data.count > 0) {\n            data.count--;//设定中奖的图片\n            $canvas.css(\"background-image\", \"url('../common/image/prize/prize2.png')\");\n            $canvasMask.hide();\n        } else {\n            alert(\"没有次数了\");\n        }\n    });\n\n    /*canvas事件*/\n    //pc端\n    $canvas.on({\n        //鼠标按下\n        mousedown: function (e) {\n            e = e || window.event;\n            e.preventDefault();\n            bool = true;\n            var x = e.pageX - $(this).offset().left,//鼠标距离该页面left的值 - 元素左侧距离文档的left\n                y = e.pageY - $(this).offset().top;\n            ctx.moveTo(x, y);\n\n            //鼠标移动\n            $canvas.on('mousemove', function (e) {\n                if (bool) {\n                    var x = e.pageX - $(this).offset().left;\n                    var y = e.pageY - $(this).offset().top;\n                    ctx.lineTo(x, y);\n                    ctx.stroke();\n                    clear();\n                }\n            });\n        },\n        //鼠标按键抬起\n        mouseup: function () {\n            bool = false;\n        }\n    });\n\n    //移动端\n    $canvas.on(\"touchstart\", function (e) {\n        e = e || window.event;\n        e.preventDefault();\n        if (typeof e.touches !== 'undefined') {\n            e = e.touches[0];//获取触点\n        }\n        var x = e.pageX - $(this).offset().left,\n            y = e.pageY - $(this).offset().top;\n        ctx.moveTo(x, y);\n        //touchmove事件\n        $canvas.on('touchmove', eventMove);\n    });\n\n    //移动事件\n    function eventMove(e) {\n        e = e || window.event;\n        e.preventDefault();\n        if (typeof e.touches !== 'undefined') {\n            e = e.touches[0];\n        }\n        var x = e.pageX - $(this).offset().left,\n            y = e.pageY - $(this).offset().top;\n        ctx.lineTo(x, y);\n        ctx.stroke();\n        clear();\n    }\n\n    //清除画布\n    function clear() {\n        if (empty) return;\n        var data = ctx.getImageData(0, 0, canvasWidth, canvasHeight).data,//得到canvas的全部数据\n            half = 0;\n\n        //length = canvasWidth * canvasHeight * 4，一个像素块是一个对象rgba四个值，a范围为0~255\n        for (var i = 3, length = data.length; i < length; i += 4) {//因为有rgba四个值，下标0开始，所以初始i=3\n            data[i] === 0 && half++;//存在imageData对象时half加1  PS:该像素区域透明即为不存在该对象\n        }\n        //当刮开的区域大于等于20%时，则可以开始处理结果\n        if (half >= canvasWidth * canvasHeight * 0.2) {\n            ctx.clearRect(0, 0, canvasWidth, canvasHeight);//清空画布\n            empty = true;\n            win();//调用中奖信息\n        }\n    }\n\n    //中奖信息提示\n    $(\"#close,.win,.btn\").click(function () {\n        empty = false;\n        init();\n    });\n\n    //奖品展示\n    var show = new Swiper(\".swiper-container\", {\n        direction: \"horizontal\",//水平方向滑动。 vertical为垂直方向滑动\n        loop: false,//是否循环\n        slidesPerView: \"auto\"//自动根据slides的宽度来设定数量\n    });\n});\n\n"]}